<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Miku's Mall Madness Demo</title>
    <link href="../style.css" rel="stylesheet"> <!-- Link to your main CSS file -->
</head>
<body>
<div class="container">
    <div class="background-light"></div>
    <div class="background-light"></div>
    <!-- Navigation for returning to other website sections -->
    <header>
        <nav class="button-container">
            <button onclick="window.location.href='../index.html'">Overview</button>
            <button onclick="window.location.href='../projects.html'">Projects</button>
            <button onclick="window.location.href='../experience.html'">Experience</button>
            <button onclick="window.location.href='../aboutMe.html'">About me</button>
        </nav>
    </header>

    <main>
        <h1>Miku's Mall Madness Demo</h1>
        <p>This game </p>
        <!-- embed is +40px for some reason -->
        <div class="game-container">
            <iframe
                    id="game-frame"
                    src="index.html"
                    title="Miku's Mall Madness">
            </iframe>
        </div>

        <script>
            const iframe = document.getElementById('game-frame');

            function resizeCanvas() {
                const container = iframe.parentElement; // Reference to .game-container
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const canvas = iframeDoc.getElementById('unity-canvas');

                if (canvas) {
                    // Get computed styles of the container
                    const styles = getComputedStyle(container);

                    // Calculate dimensions minus padding and borders
                    const containerWidth = container.offsetWidth;
                    const containerHeight = container.offsetHeight;
                    const paddingLeft = parseFloat(styles.paddingLeft);
                    const paddingRight = parseFloat(styles.paddingRight);
                    const paddingTop = parseFloat(styles.paddingTop);
                    const paddingBottom = parseFloat(styles.paddingBottom);
                    const borderLeft = parseFloat(styles.borderLeftWidth);
                    const borderRight = parseFloat(styles.borderRightWidth);
                    const borderTop = parseFloat(styles.borderTopWidth);
                    const borderBottom = parseFloat(styles.borderBottomWidth);

                    const width = Math.floor(
                        containerWidth - paddingLeft - paddingRight - borderLeft - borderRight
                    );
                    const height = Math.floor(
                        containerHeight - paddingTop - paddingBottom - borderTop - borderBottom
                    );

                    // Debug logging for key values
                    console.log("=== Resize Debugging ===");
                    console.log("Container Dimensions:", containerWidth, containerHeight);
                    console.log("Padding (L, R, T, B):", paddingLeft, paddingRight, paddingTop, paddingBottom);
                    console.log("Borders (L, R, T, B):", borderLeft, borderRight, borderTop, borderBottom);
                    console.log("Computed Canvas Size:", width, height);

                    // Update the canvas dimensions
                    canvas.style.width = `${width}px`;
                    canvas.style.height = `${height}px`;

                    // Debug canvas style size
                    console.log("Applied Canvas Style Size:", canvas.style.width, canvas.style.height);

                    // Adjust Unity rendering scale
                    const unityInstance = iframe.contentWindow.unityInstance;
                    if (unityInstance) {
                        unityInstance.SetCanvasSize(width, height, false);

                        // Debug Unity instance scaling
                        console.log("Unity Instance Canvas Size Set To:", width, height);
                    }
                } else {
                    console.warn("Canvas not found. Ensure Unity WebGL is loaded properly.");
                }
            }


            // Resize listener to adjust canvas dynamically
            window.addEventListener('resize', resizeCanvas);
            iframe.addEventListener('load', resizeCanvas); // Run on iframe load
        </script>

        <!-- Fallback message if JavaScript is disabled -->
        <noscript>
            <p style="color: var(--primary-text-color); text-align: center;">
                The game requires JavaScript to run. Please enable JavaScript in your browser to play the game.
            </p>
        </noscript>
        <p>Press in the direction you want to move, or on the buttons you want to interact with. Attacks need to be
            targeting an enemy.</p>
    </main>

    <!-- Footer section -->
    <div class="push"></div>

    <footer>
        <button onclick="window.location.href='../projects.html'">Back to Projects</button>
    </footer>
</div>
</body>
</html>